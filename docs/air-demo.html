<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIR Blackbox Gateway — Live Demo</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0a; color: #e0e0e0; line-height: 1.6; }
.container { max-width: 1100px; margin: 0 auto; padding: 20px; }
h1 { font-size: 28px; color: #fff; margin-bottom: 4px; }
.subtitle { color: #888; font-size: 15px; margin-bottom: 30px; }
.subtitle a { color: #4dabf7; text-decoration: none; }
.tabs { display: flex; gap: 2px; margin-bottom: 0; }
.tab { padding: 10px 20px; background: #1a1a1a; color: #888; border: 1px solid #2a2a2a; border-bottom: none; border-radius: 8px 8px 0 0; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.tab:hover { color: #ccc; background: #222; }
.tab.active { background: #141414; color: #fff; border-color: #333; }
.panel { display: none; background: #141414; border: 1px solid #333; border-radius: 0 8px 8px 8px; padding: 24px; min-height: 500px; }
.panel.active { display: block; }
.conversation { margin-bottom: 20px; }
.msg { padding: 12px 16px; margin-bottom: 8px; border-radius: 8px; font-size: 14px; }
.msg.user { background: #1a3a5c; border-left: 3px solid #4dabf7; }
.msg.assistant { background: #1a2a1a; border-left: 3px solid #51cf66; }
.msg.tool { background: #2a2a1a; border-left: 3px solid #ffd43b; font-family: monospace; font-size: 13px; }
.msg-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 4px; }
.msg-content { color: #e0e0e0; }.chain-entry { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 8px; padding: 16px; margin-bottom: 12px; transition: all 0.3s; position: relative; }
.chain-entry.tampered { border-color: #e03131; background: #1a1212; }
.chain-entry.tampered::after { content: "TAMPERED"; position: absolute; top: 8px; right: 12px; background: #e03131; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; }
.chain-entry.verified { border-color: #2f9e44; }
.chain-entry.verified::after { content: "VERIFIED ✓"; position: absolute; top: 8px; right: 12px; background: #2f9e44; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; }
.chain-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.chain-seq { font-weight: bold; color: #4dabf7; }
.chain-time { color: #666; font-size: 13px; }
.chain-field { display: flex; gap: 8px; margin-bottom: 4px; font-size: 13px; }
.chain-label { color: #888; min-width: 100px; }
.chain-value { font-family: monospace; color: #aaa; word-break: break-all; }
.chain-value.hash { color: #ffd43b; }
.chain-value.broken { color: #e03131; text-decoration: line-through; }
.chain-arrow { text-align: center; color: #444; font-size: 20px; margin: 4px 0; }
.btn-row { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
.btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
.btn-primary { background: #4dabf7; color: #000; }
.btn-primary:hover { background: #74c0fc; }
.btn-danger { background: #e03131; color: #fff; }
.btn-danger:hover { background: #f03e3e; }
.btn-success { background: #2f9e44; color: #fff; }
.btn-success:hover { background: #40c057; }
.btn-outline { background: transparent; color: #888; border: 1px solid #444; }
.btn-outline:hover { color: #fff; border-color: #888; }
.btn:disabled { opacity: 0.4; cursor: not-allowed; }.status-bar { padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; display: flex; align-items: center; gap: 8px; }
.status-bar.ok { background: #1a2a1a; border: 1px solid #2f9e44; color: #51cf66; }
.status-bar.fail { background: #1a1212; border: 1px solid #e03131; color: #ff6b6b; }
.status-bar.neutral { background: #1a1a2a; border: 1px solid #444; color: #aaa; }
.status-dot { width: 8px; height: 8px; border-radius: 50%; }
.status-dot.green { background: #51cf66; }
.status-dot.red { background: #e03131; }
.status-dot.gray { background: #666; }
.compliance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media (max-width: 700px) { .compliance-grid { grid-template-columns: 1fr; } }
.control { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 8px; padding: 14px; }
.control-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.control-id { font-weight: bold; color: #4dabf7; font-size: 13px; }
.control-status { font-size: 12px; padding: 2px 8px; border-radius: 4px; }
.control-status.pass { background: #2f9e44; color: #fff; }
.control-status.warn { background: #e8590c; color: #fff; }
.control-name { font-size: 14px; color: #ccc; margin-bottom: 4px; }
.control-evidence { font-size: 12px; color: #888; }
.json-block { background: #0d0d0d; border: 1px solid #2a2a2a; border-radius: 8px; padding: 16px; font-family: monospace; font-size: 12px; color: #aaa; overflow-x: auto; max-height: 400px; overflow-y: auto; white-space: pre; }
.json-key { color: #4dabf7; }
.json-string { color: #51cf66; }
.json-number { color: #ffd43b; }
.json-bool { color: #da77f2; }
.metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
@media (max-width: 700px) { .metrics { grid-template-columns: repeat(2, 1fr); } }
.metric { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 8px; padding: 14px; text-align: center; }
.metric-value { font-size: 28px; font-weight: bold; color: #fff; }
.metric-label { font-size: 12px; color: #888; margin-top: 4px; }
@keyframes flash-red { 0% { background: #1a1212; } 50% { background: #2a1515; } 100% { background: #1a1212; } }
@keyframes flash-green { 0% { background: #1a2a1a; } 50% { background: #1a3a1a; } 100% { background: #1a2a1a; } }
.flash-red { animation: flash-red 0.5s ease 2; }
.flash-green { animation: flash-green 0.5s ease 2; }
.footer { text-align: center; padding: 30px 0; color: #444; font-size: 13px; }
.footer a { color: #4dabf7; text-decoration: none; }
</style>
</head>
<body>
<div class="container">
<h1>AIR Blackbox Gateway</h1>
<p class="subtitle">Interactive Demo — <a href="https://github.com/nostalgicskinco/air-blackbox-gateway" target="_blank">github.com/nostalgicskinco/air-blackbox-gateway</a></p>
<div class="metrics">
  <div class="metric"><div class="metric-value" id="m-calls">0</div><div class="metric-label">LLM Calls Recorded</div></div>
  <div class="metric"><div class="metric-value" id="m-tokens">0</div><div class="metric-label">Tokens Tracked</div></div>
  <div class="metric"><div class="metric-value" id="m-chain">0</div><div class="metric-label">Chain Length</div></div>
  <div class="metric"><div class="metric-value" id="m-integrity">—</div><div class="metric-label">Chain Integrity</div></div>
</div>
<div class="tabs">
  <div class="tab active" onclick="showTab('agent')">Agent Conversation</div>
  <div class="tab" onclick="showTab('chain')">Audit Chain</div>
  <div class="tab" onclick="showTab('compliance')">Compliance Report</div>
  <div class="tab" onclick="showTab('export')">Evidence Export</div>
</div>
<div class="panel active" id="panel-agent">
  <div class="btn-row">
    <button class="btn btn-primary" id="btn-run" onclick="runAgent()">▶ Run Agent Simulation</button>
    <button class="btn btn-outline" onclick="resetAll()">Reset</button>
  </div>
  <div id="conversation"></div>
</div>
<div class="panel" id="panel-chain">
  <div id="chain-status" class="status-bar neutral">
    <div class="status-dot gray"></div>
    Run the agent simulation first to generate an audit chain
  </div>
  <div class="btn-row">
    <button class="btn btn-danger" id="btn-tamper" onclick="tamperChain()" disabled>Tamper with Record #2</button>
    <button class="btn btn-success" id="btn-verify" onclick="verifyChain()" disabled>Verify Chain</button>
    <button class="btn btn-outline" onclick="resetAll()">Reset</button>
  </div>
  <div id="chain-entries"></div>
</div>
<div class="panel" id="panel-compliance">
  <div id="compliance-status" class="status-bar neutral">
    <div class="status-dot gray"></div>
    Run the agent simulation to generate a compliance report
  </div>
  <div id="compliance-grid" class="compliance-grid"></div>
</div><div class="panel" id="panel-export">
  <div class="btn-row">
    <button class="btn btn-primary" id="btn-export" onclick="showExport()" disabled>Generate Evidence Export</button>
  </div>
  <div id="export-output"></div>
</div>
<div class="footer">
  <a href="https://github.com/nostalgicskinco/air-blackbox-gateway" target="_blank">GitHub</a> ·
  <a href="https://pypi.org/project/air-blackbox-sdk/" target="_blank">pip install air-blackbox-sdk</a> ·
  Apache-2.0
</div>
</div>
<script>
let entries = [];
let tampered = false;
let verified = false;
const HMAC_KEY = "air-demo-key-2024";
const agentSteps = [
  { role: "user", content: "Check our refund policy and draft a response to this customer complaint: 'I received the wrong product and want a full refund.'" },
  { role: "tool", content: "→ tool_call: search_knowledge_base(query=\"refund policy\")\n← result: \"Full refunds within 30 days for wrong items. Customer must return item. Shipping covered by company.\"", tokens: 340 },
  { role: "assistant", content: "Based on our refund policy, I'll draft a response offering a full refund since they received the wrong product. This falls within our 30-day return window.", tokens: 180 },
  { role: "tool", content: "→ tool_call: draft_email(\n  to: \"customer@example.com\",\n  subject: \"Re: Wrong Product Received — Full Refund Approved\",\n  body: \"We sincerely apologize for sending the wrong product. We've approved a full refund. A prepaid return label is attached. Your refund will process within 3-5 business days after we receive the return.\"\n)", tokens: 420 },
  { role: "assistant", content: "I've drafted the refund response email. The customer will receive a prepaid return label and full refund within 3-5 business days of return. Shall I send it?", tokens: 150 }
];function simpleHash(data, prevHash) {
  let hash = 0;
  const str = data + (prevHash || "") + HMAC_KEY;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash |= 0;
  }
  const hex = Math.abs(hash).toString(16).padStart(8, "0");
  return "a3f8" + hex + "c1d2e4f6" + hex.split("").reverse().join("") + "9b7a";
}
function showTab(name) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
  document.querySelector(`#panel-${name}`).classList.add("active");
  event.target.classList.add("active");
}
async function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
async function runAgent() {
  const btn = document.getElementById("btn-run");
  btn.disabled = true;
  btn.textContent = "Running...";
  const conv = document.getElementById("conversation");
  conv.innerHTML = "";
  entries = []; tampered = false; verified = false;
  let totalTokens = 0; let prevHash = null;
  for (let i = 0; i < agentSteps.length; i++) {
    const step = agentSteps[i];
    await sleep(600 + Math.random() * 400);    const div = document.createElement("div");
    div.className = `msg ${step.role}`;
    const label = step.role === "user" ? "USER" : step.role === "tool" ? "TOOL CALL" : "AGENT";
    div.innerHTML = `<div class="msg-label">${label}</div><div class="msg-content">${step.content.replace(/\n/g, "<br>")}</div>`;
    conv.appendChild(div);
    div.scrollIntoView({ behavior: "smooth" });
    if (step.tokens) {
      totalTokens += step.tokens;
      const entryData = JSON.stringify({ seq: entries.length + 1, role: step.role, content: step.content, tokens: step.tokens });
      const hash = simpleHash(entryData, prevHash);
      entries.push({
        seq: entries.length + 1, role: step.role,
        content: step.content.substring(0, 80) + (step.content.length > 80 ? "..." : ""),
        tokens: step.tokens, hash: hash, prevHash: prevHash,
        timestamp: new Date(Date.now() - (agentSteps.length - i) * 2300).toISOString(),
        model: "gpt-4o-mini", original: true
      });
      prevHash = hash;
    }
    document.getElementById("m-calls").textContent = entries.length;
    document.getElementById("m-tokens").textContent = totalTokens.toLocaleString();
    document.getElementById("m-chain").textContent = entries.length;
    document.getElementById("m-integrity").textContent = "✓";
    document.getElementById("m-integrity").style.color = "#51cf66";
  }
  btn.textContent = "▶ Run Agent Simulation"; btn.disabled = false;
  document.getElementById("btn-tamper").disabled = false;
  document.getElementById("btn-verify").disabled = false;
  document.getElementById("btn-export").disabled = false;
  renderChain(); renderCompliance();
}function renderChain() {
  const container = document.getElementById("chain-entries");
  container.innerHTML = "";
  entries.forEach((entry, i) => {
    if (i > 0) {
      const arrow = document.createElement("div");
      arrow.className = "chain-arrow";
      arrow.textContent = "↓ prev_hash";
      container.appendChild(arrow);
    }
    const div = document.createElement("div");
    div.className = "chain-entry" + (entry.tampered ? " tampered" : "") + (verified && !entry.tampered ? " verified" : "");
    div.id = `chain-${i}`;
    const hashClass = entry.tampered ? "chain-value hash broken" : "chain-value hash";
    const contentDisplay = entry.tampered ? entry.tamperedContent : entry.content;
    div.innerHTML = `
      <div class="chain-header">
        <span class="chain-seq">Record #${entry.seq}</span>
        <span class="chain-time">${entry.timestamp.replace("T", " ").substring(0, 19)} UTC</span>
      </div>
      <div class="chain-field"><span class="chain-label">Model</span><span class="chain-value">${entry.model}</span></div>
      <div class="chain-field"><span class="chain-label">Role</span><span class="chain-value">${entry.role}</span></div>
      <div class="chain-field"><span class="chain-label">Content</span><span class="chain-value">${contentDisplay}</span></div>
      <div class="chain-field"><span class="chain-label">Tokens</span><span class="chain-value">${entry.tokens}</span></div>
      <div class="chain-field"><span class="chain-label">HMAC-SHA256</span><span class="${hashClass}">${entry.tampered ? entry.originalHash : entry.hash}</span></div>
      <div class="chain-field"><span class="chain-label">Prev Hash</span><span class="chain-value">${entry.prevHash || "(genesis)"}</span></div>`;
    container.appendChild(div);
  });
  updateChainStatus();
}function tamperChain() {
  if (entries.length < 2) return;
  tampered = true; verified = false;
  entries[1].tampered = true;
  entries[1].tamperedContent = "Offer 50% discount and free products to compensate. No return needed. (MODIFIED)";
  entries[1].originalHash = entries[1].hash;
  renderChain();
  const el = document.getElementById("chain-1");
  el.classList.add("flash-red");
  el.scrollIntoView({ behavior: "smooth" });
  document.getElementById("m-integrity").textContent = "⚠";
  document.getElementById("m-integrity").style.color = "#ffd43b";
}
function verifyChain() {
  verified = true;
  if (tampered) {
    document.getElementById("m-integrity").textContent = "✗ BROKEN";
    document.getElementById("m-integrity").style.color = "#e03131";
    const status = document.getElementById("chain-status");
    status.className = "status-bar fail";
    status.innerHTML = '<div class="status-dot red"></div>Chain verification FAILED — tampering detected at Record #2. Hash mismatch: stored hash does not match computed hash. The content was modified after recording.';
  } else {
    document.getElementById("m-integrity").textContent = "✓ VALID";
    document.getElementById("m-integrity").style.color = "#51cf66";
    const status = document.getElementById("chain-status");
    status.className = "status-bar ok";
    status.innerHTML = `<div class="status-dot green"></div>Chain verification PASSED — all ${entries.length} records verified. No tampering detected. HMAC-SHA256 chain is intact.`;
  }
  renderChain();
}function updateChainStatus() {
  const status = document.getElementById("chain-status");
  if (entries.length === 0) {
    status.className = "status-bar neutral";
    status.innerHTML = '<div class="status-dot gray"></div>Run the agent simulation first to generate an audit chain';
  } else if (tampered && verified) {
    status.className = "status-bar fail";
    status.innerHTML = '<div class="status-dot red"></div>Chain verification FAILED — tampering detected at Record #2';
  } else if (verified) {
    status.className = "status-bar ok";
    status.innerHTML = `<div class="status-dot green"></div>Chain verification PASSED — all ${entries.length} records intact`;
  } else if (tampered) {
    status.className = "status-bar fail";
    status.innerHTML = '<div class="status-dot red"></div>Record #2 has been modified — click "Verify Chain" to detect the tampering';
  } else {
    status.className = "status-bar ok";
    status.innerHTML = `<div class="status-dot green"></div>${entries.length} records in chain — ready for verification`;
  }
}
function renderCompliance() {
  const controls = [
    { id: "SOC 2 CC6.1", name: "Logical Access Controls", status: "pass", evidence: "All LLM calls authenticated via API key. Gateway enforces access control." },
    { id: "SOC 2 CC7.2", name: "System Monitoring", status: "pass", evidence: "Continuous recording active. 4 events captured in this episode." },
    { id: "SOC 2 CC7.3", name: "Change Detection", status: "pass", evidence: "HMAC-SHA256 chain active. Tamper detection enabled on all records." },
    { id: "SOC 2 CC8.1", name: "Change Management", status: "pass", evidence: "Immutable audit trail. No records modified since recording." },
    { id: "ISO 27001 A.8.10", name: "Information Deletion", status: "pass", evidence: "Content stored in vault with configurable retention policy." },
    { id: "ISO 27001 A.8.11", name: "Data Masking", status: "pass", evidence: "PII redaction active. Email addresses masked in audit records." },
    { id: "ISO 27001 A.12.4", name: "Logging & Monitoring", status: "pass", evidence: "Full request/response logging with OpenTelemetry trace correlation." },
    { id: "ISO 27001 A.18.1", name: "Legal Compliance", status: "pass", evidence: "Signed evidence export available. Chain of custody maintained." },    { id: "EU AI Act Art.12", name: "Record-Keeping", status: "pass", evidence: "Automatic logging of AI system decisions with full input/output capture." },
    { id: "EU AI Act Art.13", name: "Transparency", status: "pass", evidence: "Complete audit trail available for inspection. Deterministic replay enabled." },
  ];
  const grid = document.getElementById("compliance-grid");
  grid.innerHTML = "";
  controls.forEach(c => {
    const div = document.createElement("div");
    div.className = "control";
    div.innerHTML = `
      <div class="control-header">
        <span class="control-id">${c.id}</span>
        <span class="control-status ${c.status}">${c.status === "pass" ? "PASS" : "WARN"}</span>
      </div>
      <div class="control-name">${c.name}</div>
      <div class="control-evidence">${c.evidence}</div>`;
    grid.appendChild(div);
  });
  const status = document.getElementById("compliance-status");
  status.className = "status-bar ok";
  status.innerHTML = `<div class="status-dot green"></div>10 of 10 controls passing — episode compliant across SOC 2, ISO 27001, and EU AI Act`;
}
function showExport() {
  const exportData = {
    air_evidence_export: { version: "1.0.0", generated_at: new Date().toISOString(), gateway_version: "0.8.0", signing_algorithm: "HMAC-SHA256" },
    episode: { id: "ep_" + Math.random().toString(36).substring(2, 10), started_at: entries[0]?.timestamp, completed_at: entries[entries.length - 1]?.timestamp, total_calls: entries.length, total_tokens: entries.reduce((s, e) => s + e.tokens, 0), model: "gpt-4o-mini", chain_integrity: tampered ? "FAILED" : "VERIFIED" },
    audit_chain: entries.map(e => ({ sequence: e.seq, timestamp: e.timestamp, role: e.role, content_hash: simpleHash(e.content, ""), content_ref: `vault://episodes/2026/02/record-${e.seq}.json`, tokens: e.tokens, chain_hash: e.hash, prev_hash: e.prevHash || null })),
    compliance: { frameworks: ["SOC 2 Type II", "ISO 27001:2022", "EU AI Act"], controls_evaluated: 10, controls_passing: tampered ? 8 : 10, controls_failing: tampered ? 2 : 0 },
    signature: "HMAC-SHA256:" + simpleHash(JSON.stringify(entries), HMAC_KEY)
  };
  const container = document.getElementById("export-output");
  container.innerHTML = `<div class="json-block">${syntaxHighlight(JSON.stringify(exportData, null, 2))}</div>`;
}function syntaxHighlight(json) {
  return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
    let cls = "json-number";
    if (/^"/.test(match)) { cls = /:$/.test(match) ? "json-key" : "json-string"; }
    else if (/true|false/.test(match)) { cls = "json-bool"; }
    return `<span class="${cls}">${match}</span>`;
  });
}
function resetAll() {
  entries = []; tampered = false; verified = false;
  document.getElementById("conversation").innerHTML = "";
  document.getElementById("chain-entries").innerHTML = "";
  document.getElementById("compliance-grid").innerHTML = "";
  document.getElementById("export-output").innerHTML = "";
  document.getElementById("m-calls").textContent = "0";
  document.getElementById("m-tokens").textContent = "0";
  document.getElementById("m-chain").textContent = "0";
  document.getElementById("m-integrity").textContent = "—";
  document.getElementById("m-integrity").style.color = "#e0e0e0";
  document.getElementById("btn-tamper").disabled = true;
  document.getElementById("btn-verify").disabled = true;
  document.getElementById("btn-export").disabled = true;
  updateChainStatus();
  const compStatus = document.getElementById("compliance-status");
  compStatus.className = "status-bar neutral";
  compStatus.innerHTML = '<div class="status-dot gray"></div>Run the agent simulation to generate a compliance report';
}
</script>
</body>
</html>